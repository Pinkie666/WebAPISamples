var gulp = require('gulp'),    args = require('yargs').argv,    fs = require('fs'),    wrapper = require('./wrapper'),    assemblyInfo = require('gulp-dotnet-assembly-info'),    msbuild = require('gulp-msbuild'),    xmlpoke = require('gulp-xmlpoke'),    nunit = require('gulp-nunit-runner'),    Nuget = require('nuget-runner');gulp.task('ci', ['nuget-package']);gulp.task('deploy', ['nuget-push']);gulp.task('wrapper', function(cb) {    wrapper('../spec.json',         './Wrapper/Reachmail/Reachmail.Template.cs',        './Wrapper/Reachmail/Reachmail.cs');    cb();});gulp.task('assemblyInfo', ['wrapper'], function() {    return gulp        .src('**/AssemblyInfo.cs')        .pipe(assemblyInfo({            company: 'Reachmail Inc.',            product: 'Reachmail API Wrapper',            title: 'Reachmail API Wrapper',            description: 'Wrapper for the Reachmail API.',            copyright: 'Copyright (c) ' + new Date().getFullYear() + ' Reachmail Inc.',            version: args.buildVersion,            fileVersion: args.buildVersion        }))        .pipe(gulp.dest('.'));});gulp.task('build', ['assemblyInfo'], function() {    return gulp        .src('**/*.sln')        .pipe(msbuild({            toolsVersion: 4.0,            targets: ['Clean', 'Build'],            stdout: true,            errorOnFail: true        }));});gulp.task('test', ['build'], function () {    gulp.src('Wrapper/Tests/bin/*/Tests.dll.config', { base: '.' })        .pipe(xmlpoke({          replacements : [{              xpath : 'configuration/appSettings/add[@key="Token"]/@value',                     value: args.apiToken           }]         }))        .pipe(gulp.dest('.'));    return gulp        .src(['Wrapper/Tests/bin/**/Tests.dll'], { read: false })        .pipe(nunit({            teamcity: true        }));});gulp.task('nuget-package', ['test'], function() {    gulp.src('Wrapper/Reachmail/bin/Release/Reachmail.*')        .pipe(gulp.dest('package/lib'));    return Nuget()        .pack({            spec: 'Reachmail.nuspec',            basePath: 'package',            version: args.buildVersion        });});gulp.task('nuget-push', ['nuget-package'], function() {    return Nuget({ apiKey: args.nugetApiKey }).push('*.nupkg');});